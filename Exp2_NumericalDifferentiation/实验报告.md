# 实验二：数值微分的误差权衡

## 1. 实验目的
- 理解数值微分中截断误差与舍入误差的权衡关系
- 观察有限差分法计算导数时的误差变化规律
- 分析步长对数值微分精度的影响
- 确定最优步长范围

## 2. 实验方法
### 2.1 理论基础
数值微分是通过有限差分近似导数的计算方法。本实验实现了两种差分方法：
- 前向差分法: $f'(x) \approx \frac{f(x+\delta) - f(x)}{\delta}$
- 中心差分法: $f'(x) \approx \frac{f(x+\delta) - f(x-\delta)}{2\delta}$

### 2.2 测试函数
本实验使用函数 $f(x) = x(x-1)$，其解析导数为 $f'(x) = 2x - 1$。

### 2.3 实验步骤
1. 实现前向差分和中心差分函数
2. 在 $x=1$ 点计算不同步长下的数值导数
3. 计算数值导数与解析导数的相对误差
4. 绘制误差-步长关系图（对数坐标）
5. 分析最优步长和收敛阶数

## 3. 实验结果
### 3.1 数据表格
| 步长(δ) | 前向差分值 | 中心差分值 | 解析解 | 前向差分相对误差 | 中心差分相对误差 |
|---------|------------|------------|--------|------------------|------------------|
| 1.00e-02 |            |            | 1.0    |                  |                  |
| 1.00e-04 |            |            | 1.0    |                  |                  |
| 1.00e-06 |            |            | 1.0    |                  |                  |
| 1.00e-08 |            |            | 1.0    |                  |                  |
| 1.00e-10 |            |            | 1.0    |                  |                  |
| 1.00e-12 |            |            | 1.0    |                  |                  |
| 1.00e-14 |            |            | 1.0    |                  |                  |

### 3.2 误差-步长关系图
![Figure_1](https://github.com/user-attachments/assets/a72243a5-6530-4862-91ce-6c61c1b16be6)


## 4. 分析与讨论
### 4.1 误差来源分析
数值微分中存在两种主要误差来源：
- **截断误差**：由于使用有限差分近似导数定义引入的误差，通常随步长减小而减小
- **舍入误差**：由于计算机浮点数表示的有限精度引入的误差，通常随步长减小而增大

- 截断误差：数值微分是对导数定义的近似，使用有限步长代替极限过程，产生截断误差。步长越小，截断误差理论上越小。
- 舍入误差：计算机存储和计算浮点数存在精度限制，步长过小时，函数值相减可能导致有效数字损失，舍入误差增大。

### 4.2 前向差分与中心差分的比较
（比较两种方法的精度差异，并解释原因）
当步长较大时，两者误差都处于较高水平，但中心差分误差下降速度更快；随着步长减小，中心差分能在更小区间内保持较低误差，而前向差分误差在步长减小到一定程度后，下降趋势变缓并开始上升。
### 4.3 最优步长分析
（分析实验中观察到的最优步长，并解释为什么存在最优步长）
- 观察结果：对于中心差分，相对误差最小的点对应的步长约为10^{-9} ；前向差分相对误差最小的点对应的步长约为10^{-7} 。这就是实验中观察到的两种方法的最优步长。
- 存在原因：数值微分存在截断误差和舍入误差。大的步长下，截断误差主导，随着步长减小，截断误差降低，误差随之减小；但步长过小，计算机浮点数精度限制使舍入误差增大。两种误差相互作用，在某一特定步长下，总误差达到最小，此步长即为最优步长 。
### 4.4 收敛阶数分析
（分析两种方法的收敛阶数，并与理论预期进行比较）
- 前向差分：图中绿色虚线代表一阶收敛O(h) ，前向差分（蓝色折线）在步长较大区域，误差变化趋势与绿色虚线接近，表明其收敛阶数接近理论预期的一阶。但在步长很小时，受舍入误差影响，偏离了理论趋势。
- 中心差分：图中红色虚线代表二阶收敛O(h^2) ，中心差分（橙色折线）在步长较大到一定范围时，误差变化趋势与红色虚线较为相符，说明其收敛阶数符合理论预期的二阶 。不过在步长极小时，同样因舍入误差等因素，与理论趋势有一定偏离。
## 5. 实验结论
（总结本实验的主要发现，特别是关于误差权衡、最优步长和不同差分方法的优缺点）
- 误差权衡：数值微分中截断误差和舍入误差相互制约。步长影响二者平衡，大则截断误差大，小则舍入误差大，需合理选择步长以平衡误差。
- 最优步长：前向差分和中心差分分别存在最优步长，此时总误差最小。使用最优步长可提升数值微分精度。
- 差分方法优缺点：中心差分精度更高，收敛阶数为二阶，在相同步长下误差更小；前向差分简单但精度低，收敛阶数为一阶。实际应用中需根据精度要求、计算资源等选择合适的差分方法。
## 附录：核心代码片段
```python
# 前向差分法实现
def forward_diff(f, x, delta):
    return (f(x + delta) - f(x)) / delta

# 中心差分法实现
def central_diff(f, x, delta):
    return (f(x + delta) - f(x - delta)) / (2 * delta)

# 计算误差的代码
# ...

# 绘制误差-步长关系图的代码
# ...
```
